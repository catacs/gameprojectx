<head>
 <link href="pantheios.css" rel="stylesheet" type="text/css">
<!--
 <title>Pantheios - The C++ Diagnostic Logging Sweetspot</title>
-->
</head>

<table width = "100%">
 <tr>
  <td align = "left" valign = "middle">
   <a href = "http://www.synesis.com.au/"><img src = "syn_head.jpg" border = "0" width = "343" height = "50" alt = "Synesis Software" /></a>
  </td>
  <td align = "right" valign = "middle">
   <a href = "http://stlsoft.org"><img src = "stlsoft200x100.jpg" border = "0" width = "100" height = "50" alt = "STLSoft - ... Robust, Lightweight, Cross-platform, Template Software ..." /></a>
  </td>
 </tr>
 <tr>
  <td width = "100%" colspan = "2">
   <hr width = "100%">
  </td>
 </tr>
</table>
<!-- Generated by Doxygen 1.5.4 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
  </ul>
</div>
<h1>cpp/example.cpp.custom_type_1/example.cpp.custom_type_1.cpp</h1>Demonstrates four techniques for diagnostic logging of custom types:<ul>
<li>use of <b>explicit conversion code</b> for custom type</li><li>definition of <b>specific conversion function</b> for custom type</li><li>definition of <b>string access shims</b> for custom type</li><li>definition of <b>inserter class</b> for custom type</li></ul>
<p>
<div class="fragment"><pre class="fragment"><span class="comment">/* /////////////////////////////////////////////////////////////////////////</span>
<span class="comment"> * File:        examples/cpp/example.cpp.custom_type_1/example.cpp.custom_type_1.cpp</span>
<span class="comment"> *</span>
<span class="comment"> * Purpose:     C++ example program for Pantheios. Demonstrates:</span>
<span class="comment"> *</span>
<span class="comment"> *                - use of explicit conversion code for custom type</span>
<span class="comment"> *                - definition of specific conversion function for custom type</span>
<span class="comment"> *                - definition of string access shims for custom type</span>
<span class="comment"> *                - definition of inserter class for custom type</span>
<span class="comment"> *                - use of pantheios::logputs() in bail-out conditions</span>
<span class="comment"> *</span>
<span class="comment"> * Created:     31st August 2006</span>
<span class="comment"> * Updated:     1st January 2009</span>
<span class="comment"> *</span>
<span class="comment"> * www:         http://www.pantheios.org/</span>
<span class="comment"> *</span>
<span class="comment"> * License:     This source code is placed into the public domain 2006</span>
<span class="comment"> *              by Synesis Software Pty Ltd. There are no restrictions</span>
<span class="comment"> *              whatsoever to your use of the software.</span>
<span class="comment"> *</span>
<span class="comment"> *              This software is provided "as is", and any warranties,</span>
<span class="comment"> *              express or implied, of any kind and for any purpose, are</span>
<span class="comment"> *              disclaimed.</span>
<span class="comment"> *</span>
<span class="comment"> * ////////////////////////////////////////////////////////////////////// */</span>


<span class="comment">// NOTE: There is a bug in the two-phase lookup (at least I think it's</span>
<span class="comment">//  there) of GCC (except, afaict, the Mac OS-X version, which works fine),</span>
<span class="comment">//  which results in the custom string access shims for Person not being</span>
<span class="comment">//  detected unless they're defined or, as in this case, declared _before_</span>
<span class="comment">//  the inclusion of pantheios/pantheios.hpp.</span>
<span class="comment">//</span>
<span class="comment">//  In normal applications, this is going to be easy to handle, since your</span>
<span class="comment">//  custom types are likely to be defined (and their shims</span>
<span class="comment">//  defined/declared) in a header file. Since good practice dictates that</span>
<span class="comment">//  application-specific headers should be included before library headers</span>
<span class="comment">//  you'd probably see something like the following:</span>
<span class="comment">//</span>
<span class="comment">//    #include "myappcomponent.h"</span>
<span class="comment">//    #include "person.h"</span>
<span class="comment">//</span>
<span class="comment">//    #include &lt;pantheios/pantheios/hpp&gt;</span>
<span class="comment">//</span>
<span class="comment">//    #include &lt;vector&gt;</span>
<span class="comment">//</span>
<span class="comment">//  or similar.</span>
<span class="comment">//</span>
<span class="comment">//  In this case, however, we must synthesise this situation by doing the</span>
<span class="comment">//  forward declarations in this file. We only do this for GCC (and not on</span>
<span class="comment">//  Mac) since the other compilers all do the right thing.</span>


<span class="preprocessor">#include &lt;stlsoft/stlsoft.h&gt;</span>
<span class="preprocessor">#include &lt;platformstl/platformstl.h&gt;</span>    <span class="comment">// Need to detect comp+OS: see above</span>
<span class="preprocessor">#if defined(STLSOFT_COMPILER_IS_GCC) &amp;&amp; \</span>
<span class="preprocessor">    (   !defined(UNIXSTL_OS_IS_MACOSX) || \</span>
<span class="preprocessor">        __GNUC__ &lt; 4)</span>
<span class="preprocessor"></span><span class="comment">// There's something wrong with GCC, so we have to fwd declare these things</span>
<span class="preprocessor"># include &lt;stlsoft/string/shim_string.hpp&gt;</span>
<span class="keyword">class </span>Person;
<span class="keyword">class </span>Person_inserter;
<span class="keyword">namespace </span>stlsoft
{
  <span class="keywordtype">char</span> <span class="keyword">const</span> *c_str_data_a(Person_inserter <span class="keyword">const</span>&amp; pi);
  <span class="keywordtype">size_t</span> c_str_len_a(Person_inserter <span class="keyword">const</span>&amp; pi);
  stlsoft::basic_shim_string&lt;char&gt; c_str_data_a(Person <span class="keyword">const</span>&amp; person);
  <span class="keywordtype">size_t</span> c_str_len_a(Person <span class="keyword">const</span>&amp; pi);

} <span class="comment">// namespace stlsoft</span>
<span class="preprocessor">#endif </span><span class="comment">/* compiler */</span>


<span class="comment">/* Pantheios Header Files */</span>
<span class="preprocessor">#include &lt;<a class="code" href="pantheios_8hpp.html" title="[C++ only] Primary header file for the Pantheios Application Layer API, and included...">pantheios/pantheios.hpp</a>&gt;</span>                          <span class="comment">// Pantheios C++ main header</span>
<span class="preprocessor">#include &lt;<a class="code" href="integer_8hpp.html" title="[C++ only] Definition of the pantheios::integer string inserter for for integral...">pantheios/inserters/integer.hpp</a>&gt;</span>                  <span class="comment">// for pantheios::integer</span>
<span class="preprocessor">#include &lt;<a class="code" href="w2m_8hpp.html" title="[C++ only] Class for inserting wide strings.">pantheios/inserters/w2m.hpp</a>&gt;</span>                      <span class="comment">// for pantheios::w2m</span>
<span class="preprocessor">#include &lt;<a class="code" href="contract_8h.html" title="[C, C++] Defines the contract enforcement constructs used in the Pantheios core and...">pantheios/quality/contract.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="safestr_8h.html" title="[C, C++] INTERNAL FILE: Handles detection of safe string library.">pantheios/internal/safestr.h</a>&gt;</span>

<span class="comment">/* STLSoft Header Files */</span>
<span class="preprocessor">#include &lt;stlsoft/conversion/char_conversions.hpp&gt;</span>          <span class="comment">// for stlsoft::w2m</span>
<span class="preprocessor">#include &lt;stlsoft/conversion/integer_to_string.hpp&gt;</span>         <span class="comment">// for stlsoft::integer_to_string</span>
<span class="preprocessor">#include &lt;<a class="code" href="auto__buffer__selector_8hpp.html" title="[C++ only] Type generator template (see 12.2 of Extended STL, volume 1; http://extendedstl...">pantheios/util/memory/auto_buffer_selector.hpp</a>&gt;</span>   <span class="comment">// for stlsoft::auto_buffer</span>
<span class="preprocessor">#include &lt;stlsoft/string/shim_string.hpp&gt;</span>                   <span class="comment">// for stlsoft::shim_string</span>

<span class="comment">/* Standard C/C++ Header Files */</span>
<span class="preprocessor">#include &lt;exception&gt;</span>                                        <span class="comment">// for std::exception</span>
<span class="preprocessor">#include &lt;new&gt;</span>                                              <span class="comment">// for std::bad_alloc</span>
<span class="preprocessor">#include &lt;string&gt;</span>                                           <span class="comment">// for std::string</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>                                         <span class="comment">// for exit codes</span>

<span class="comment">/* ////////////////////////////////////////////////////////////////////// */</span>

<span class="preprocessor">#if defined(STLSOFT_COMPILER_IS_MSVC) &amp;&amp; \</span>
<span class="preprocessor">    defined(PANTHEIOS_USING_SAFE_STR_FUNCTIONS)</span>
<span class="preprocessor"></span><span class="preprocessor"># pragma warning(disable : 4996)</span>
<span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* VC++ &amp;&amp; Safe String */</span>

<span class="comment">/* ////////////////////////////////////////////////////////////////////// */</span>

<span class="keyword">class </span>Person
{
<span class="keyword">private</span>:
  <span class="keyword">typedef</span> std::wstring string_type;

<span class="keyword">public</span>:
  Person(<span class="keywordtype">wchar_t</span> <span class="keyword">const</span> *forename, <span class="keywordtype">wchar_t</span> <span class="keyword">const</span> *surname, <span class="keywordtype">unsigned</span> age)
    : m_forename(forename)
    , m_surname(surname)
    , m_age(age)
  {}

<span class="keyword">public</span>:
  string_type <span class="keyword">const</span>&amp; forename()<span class="keyword"> const</span>
<span class="keyword">  </span>{
    <span class="keywordflow">return</span> m_forename;
  }
  string_type <span class="keyword">const</span>&amp; surname()<span class="keyword"> const</span>
<span class="keyword">  </span>{
    <span class="keywordflow">return</span> m_surname;
  }
  <span class="keywordtype">unsigned</span>          age()<span class="keyword"> const</span>
<span class="keyword">  </span>{
    <span class="keywordflow">return</span> m_age;
  }

<span class="keyword">private</span>:
  <span class="keyword">const</span> string_type m_forename;
  <span class="keyword">const</span> string_type m_surname;
  <span class="keyword">const</span> <span class="keywordtype">unsigned</span>    m_age;

<span class="keyword">private</span>:
  Person &amp;operator =(Person <span class="keyword">const</span>&amp;);
};

<span class="comment">/* ////////////////////////////////////////////////////////////////////// */</span>

<span class="comment">/* Define the stock front-end process identity, so that it links when using</span>
<span class="comment"> * fe.N, fe.simple, etc. */</span>
<a name="a0"></a><a class="code" href="group__group____utility.html#g09ac165c2a9beab1d092a387f8db273b" title="Resolves to extern when compiling in C, and extern &amp;quot;C&amp;quot; when compiling in...">PANTHEIOS_EXTERN_C</a> <span class="keyword">const</span> <span class="keywordtype">char</span> <a name="a1"></a><a class="code" href="group__group____frontend____stock__frontends.html#g9f990b207dbc3141195a689fca418e0e" title="The application must define this variable, to contain the application name/identity...">PANTHEIOS_FE_PROCESS_IDENTITY</a>[] = <span class="stringliteral">"example.cpp.custom_type_1"</span>;

<span class="comment">/* ////////////////////////////////////////////////////////////////////// */</span>

<span class="keyword">static</span> <span class="keywordtype">void</span> log_with_explicit_conversion_code(Person <span class="keyword">const</span>&amp; person);
<span class="keyword">static</span> <span class="keywordtype">void</span> log_with_conversion_function(Person <span class="keyword">const</span>&amp; person);
<span class="keyword">static</span> <span class="keywordtype">void</span> log_with_string_access_shims(Person <span class="keyword">const</span>&amp; person);
<span class="keyword">static</span> <span class="keywordtype">void</span> log_with_inserter_class(Person <span class="keyword">const</span>&amp; person);

<span class="comment">/* ////////////////////////////////////////////////////////////////////// */</span>

<span class="keywordtype">int</span> main()
{
  <span class="keywordflow">try</span>
  {
    Person  person(L<span class="stringliteral">"Dr"</span>, L<span class="stringliteral">"Proctor"</span>, 38);

    <span class="comment">// log with explicit conversion</span>

    log_with_explicit_conversion_code(person);

    <span class="comment">// log with conversion function</span>

    log_with_conversion_function(person);

    <span class="comment">// log with string access shims</span>

    log_with_string_access_shims(person);

    <span class="comment">// log with inserter class</span>

    log_with_inserter_class(person);


    <span class="keywordflow">return</span> EXIT_SUCCESS;
  }
  <span class="keywordflow">catch</span>(std::bad_alloc&amp;)
  {
    <a name="a2"></a><a class="code" href="group__group____application__layer__interface____generated.html#gd150b8501e864d20e7c8353c94b848d8" title="Logs 1 object of arbitrary type, subject to severity-level filtering.">pantheios::log</a>(pantheios::alert, <span class="stringliteral">"out of memory"</span>);
  }
  <span class="keywordflow">catch</span>(std::exception&amp; x)
  {
    <a name="a3"></a><a class="code" href="group__group____application__layer__interface____generated.html#gdff87b92f170603f3d1ec4e7c3280f26" title="Logs 1 object of arbitrary type, subject to severity-level filtering, at severity...">pantheios::log_CRITICAL</a>(<span class="stringliteral">"Exception: "</span>, x);
  }
  <span class="keywordflow">catch</span>(...)
  {
    <a name="a4"></a><a class="code" href="group__group____core__library.html#gbf39a5a7c7deb9e91506d23ec13def28" title="Equivalent to pantheios_logputs().">pantheios::logputs</a>(pantheios::emergency, <span class="stringliteral">"Unexpected unknown error"</span>);
  }

  <span class="keywordflow">return</span> EXIT_FAILURE;
}

<span class="comment">/* ////////////////////////////////////////////////////////////////////// */</span>

<span class="keyword">static</span> <span class="keywordtype">void</span> log_with_explicit_conversion_code(Person <span class="keyword">const</span>&amp; person)
{
  <span class="keywordflow">if</span>(<a name="a5"></a><a class="code" href="group__group____core__library.html#g31ef784dc1cbc0fa6163d64b6363140a" title="Equivalent to pantheios_isSeverityLogged().">pantheios::isSeverityLogged</a>(pantheios::notice))
  {
    <span class="comment">// Since Person's names are wide, we need to convert</span>

    <span class="comment">// NOTE: this code does not check for stlsoft::w2m() failure (returns size_t(-1))</span>

    <span class="comment">// 1. Create buffers for conversion. (auto_buffer used to minimise heap</span>
    <span class="comment">//     when not necessary.)</span>

    <a name="a6"></a><a class="code" href="group__group____application__layer__interface____generated.html#g8bd2ef52fe9b01bc7f60483072e65d96" title="Logs 1 object of arbitrary type, subject to severity-level filtering, at severity...">pantheios::log_NOTICE</a>(<span class="stringliteral">"Person: "</span>, <a name="_a7"></a><a class="code" href="classpantheios_1_1w2m.html" title="Class for inserting wide strings into Pantheios diagnostic logging statements.">pantheios::w2m</a>(person.forename().c_str()), <span class="stringliteral">" "</span>, <a class="code" href="classpantheios_1_1w2m.html" title="Class for inserting wide strings into Pantheios diagnostic logging statements.">pantheios::w2m</a>(person.surname().c_str()), <span class="stringliteral">", aged "</span>, <a name="_a8"></a><a class="code" href="classpantheios_1_1integer.html" title="Class for inserting integral types into Pantheios diagnostic logging statements.">pantheios::integer</a>(person.age()));
  }
}

<span class="comment">/* ////////////////////////////////////////////////////////////////////// */</span>

<span class="keyword">static</span> std::string Person_to_string(Person <span class="keyword">const</span>&amp; person)
{
  <span class="comment">// Since Person's names are wide, we need to convert</span>

  <span class="comment">// NOTE: this code does not check for wcstombs() failure (returns size_t(-1))</span>

  <span class="comment">// 1. Create buffers for conversion. (auto_buffer used to minimise heap</span>
  <span class="comment">//     when not necessary.)</span>

  <span class="keyword">typedef</span> <a name="_a9"></a><a class="code" href="structpantheios_1_1util_1_1auto__buffer__selector.html" title="Type-generator template that deduces the appropriate specialisation of stlsoft::auto_buffer...">pantheios::util::auto_buffer_selector&lt;char, 256&gt;::type</a> buffer_t;

  buffer_t  forename(1 + ::wcstombs(NULL, person.forename().c_str(), 0));
  buffer_t  surname(1 + ::wcstombs(NULL, person.surname().c_str(), 0));

  <span class="comment">// 2. Convert</span>

  ::wcstombs(forename.data(), person.forename().data(), forename.size());
  ::wcstombs(surname.data(), person.surname().data(), surname.size());

  <a name="a10"></a><a class="code" href="contract_8h.html#34dfe66779f2dee20755adfb3b93b243" title="Postcondition (return-value) contract enforcement (application layer).">PANTHEIOS_CONTRACT_ENFORCE_POSTCONDITION_RETURN_APPL_LAYER</a>(<span class="charliteral">'\0'</span> == forename[forename.size() - 1], <span class="stringliteral">"the forename was incorrectly converted"</span>);
  <a class="code" href="contract_8h.html#34dfe66779f2dee20755adfb3b93b243" title="Postcondition (return-value) contract enforcement (application layer).">PANTHEIOS_CONTRACT_ENFORCE_POSTCONDITION_RETURN_APPL_LAYER</a>(<span class="charliteral">'\0'</span> == surname[surname.size() - 1], <span class="stringliteral">"the surname was incorrectly converted"</span>);

  std::string result(forename.data(), forename.size() - 1);
  <span class="keywordtype">char</span>        sz[21];

  result.append(<span class="stringliteral">" "</span>, 1);
  result.append(surname.data(), surname.size() - 1);
  result += <span class="stringliteral">", aged "</span>;
  result += stlsoft::integer_to_string(sz, STLSOFT_NUM_ELEMENTS(sz), person.age());

  <span class="keywordflow">return</span> result;
}

<span class="keyword">static</span> <span class="keywordtype">void</span> log_with_conversion_function(Person <span class="keyword">const</span>&amp; person)
{
  <a class="code" href="group__group____application__layer__interface____generated.html#g8bd2ef52fe9b01bc7f60483072e65d96" title="Logs 1 object of arbitrary type, subject to severity-level filtering, at severity...">pantheios::log_NOTICE</a>(<span class="stringliteral">"Person: "</span>, Person_to_string(person));
}

<span class="comment">/* ////////////////////////////////////////////////////////////////////// */</span>

<span class="keyword">namespace </span>stlsoft
{

  <span class="keyword">inline</span> stlsoft::basic_shim_string&lt;char&gt; c_str_data_a(Person <span class="keyword">const</span>&amp; person)
  {
    <span class="keywordtype">char</span>          sz[21];
    <span class="keywordtype">size_t</span>        cchNumber;
    <span class="keywordtype">char</span> <span class="keyword">const</span>    *num        = stlsoft::integer_to_string(sz, STLSOFT_NUM_ELEMENTS(sz), person.age(), cchNumber);
    <span class="keyword">const</span> <span class="keywordtype">size_t</span>  cchForename = ::wcstombs(NULL, person.forename().data(), 0);
    <span class="keyword">const</span> <span class="keywordtype">size_t</span>  cchSurname  = ::wcstombs(NULL, person.surname().data(), 0);
    <span class="keywordtype">char</span>          *p;

    stlsoft::basic_shim_string&lt;char&gt;    s(person.forename().size() + 1 + person.surname().size() + 7 + cchNumber);

    p = s.data();
    p += ::wcstombs(p + 0, person.forename().data(), cchForename);
    p = ::strncpy(p, <span class="stringliteral">" "</span>, 1) + 1;
    p += ::wcstombs(p, person.surname().data(), cchSurname);
    p = ::strncpy(p, <span class="stringliteral">", aged "</span>, 7);
    p = ::strncpy(p + 7, num, cchNumber);
    p += cchNumber;
    p[0] = <span class="charliteral">'\0'</span>;

    <a class="code" href="contract_8h.html#34dfe66779f2dee20755adfb3b93b243" title="Postcondition (return-value) contract enforcement (application layer).">PANTHEIOS_CONTRACT_ENFORCE_POSTCONDITION_RETURN_APPL_LAYER</a>(p == s.data() + s.size(), <span class="stringliteral">"incorrect number of characters written"</span>);

    <span class="keywordflow">return</span> s;
  }

  <span class="keyword">inline</span> <span class="keywordtype">size_t</span> c_str_len_a(Person <span class="keyword">const</span>&amp; person)
  {
    <span class="keywordtype">char</span>          sz[21];
    <span class="keywordtype">size_t</span>        cchNumber;
    <span class="keywordtype">char</span> <span class="keyword">const</span>    *num        = stlsoft::integer_to_string(sz, STLSOFT_NUM_ELEMENTS(sz), person.age(), cchNumber);
    <span class="keyword">const</span> <span class="keywordtype">size_t</span>  cchForename = ::wcstombs(NULL, person.forename().data(), 0);
    <span class="keyword">const</span> <span class="keywordtype">size_t</span>  cchSurname  = ::wcstombs(NULL, person.surname().data(), 0);

  STLSOFT_SUPPRESS_UNUSED(num);

    <span class="keywordflow">return</span> cchForename + 1 + cchSurname + 7 + cchNumber;
  }

} <span class="comment">// namespace stlsoft</span>

<span class="keyword">static</span> <span class="keywordtype">void</span> log_with_string_access_shims(Person <span class="keyword">const</span>&amp; person)
{
  <a class="code" href="group__group____application__layer__interface____generated.html#g8bd2ef52fe9b01bc7f60483072e65d96" title="Logs 1 object of arbitrary type, subject to severity-level filtering, at severity...">pantheios::log_NOTICE</a>(<span class="stringliteral">"Person: "</span>, person);
}

<span class="comment">/* ////////////////////////////////////////////////////////////////////// */</span>

<span class="keyword">class </span>Person_inserter
{
<span class="keyword">public</span>:
  <span class="keyword">typedef</span> Person_inserter class_type;

<span class="keyword">public</span>:
  Person_inserter(Person <span class="keyword">const</span>&amp; person)
    : m_person(person)
    , m_value(0)
  {}

<span class="preprocessor">#if defined(STLSOFT_COMPILER_IS_GCC)</span>
<span class="preprocessor"></span>  Person_inserter(class_type <span class="keyword">const</span>&amp; rhs)
    : m_person(m_person)
    , m_value(m_value.size())
  {
    ::memcpy(&amp;m_value[0], &amp;rhs.m_value[0], m_value.size());
  }
<span class="preprocessor">#endif </span><span class="comment">/* compiler */</span>

<span class="keyword">public</span>:
  <span class="keywordtype">char</span> <span class="keyword">const</span>  *data()<span class="keyword"> const</span>
<span class="keyword">  </span>{
    <span class="keywordflow">if</span>(m_value.empty())
    {
      construct_();
    }

    <span class="keywordflow">return</span> m_value.data();
  }
  <span class="keywordtype">size_t</span> size()<span class="keyword"> const</span>
<span class="keyword">  </span>{
    <span class="keywordflow">if</span>(m_value.empty())
    {
      construct_();
    }

    <span class="keywordflow">return</span> m_value.size();
  }

<span class="keyword">public</span>:
  <span class="keywordtype">void</span> construct_()<span class="keyword"> const</span>
<span class="keyword">  </span>{
    <span class="keyword">const_cast&lt;</span>class_type*<span class="keyword">&gt;</span>(<span class="keyword">this</span>)-&gt;construct_();
  }
  <span class="keywordtype">void</span> construct_()
  {
    <span class="keywordtype">char</span>          sz[21];
    <span class="keywordtype">size_t</span>        cchNumber;
    <span class="keywordtype">char</span> <span class="keyword">const</span>    *num        = stlsoft::integer_to_string(sz, STLSOFT_NUM_ELEMENTS(sz), m_person.age(), cchNumber);
    <span class="keyword">const</span> <span class="keywordtype">size_t</span>  cchForename = ::wcstombs(NULL, m_person.forename().data(), 0);
    <span class="keyword">const</span> <span class="keywordtype">size_t</span>  cchSurname  = ::wcstombs(NULL, m_person.surname().data(), 0);
    <span class="keywordtype">char</span>          *p;

    m_value.resize(cchForename + 1 + cchSurname + 7 + cchNumber);

    p = m_value.data();
    p += ::wcstombs(p + 0, m_person.forename().data(), cchForename);
    p = ::strncpy(p, <span class="stringliteral">" "</span>, 1);
    p += 1;
    p += ::wcstombs(p, m_person.surname().data(), cchSurname);
    p = ::strncpy(p, <span class="stringliteral">", aged "</span>, 7);
    p = ::strncpy(p + 7, num, cchNumber);
    p += cchNumber;

    <a class="code" href="contract_8h.html#34dfe66779f2dee20755adfb3b93b243" title="Postcondition (return-value) contract enforcement (application layer).">PANTHEIOS_CONTRACT_ENFORCE_POSTCONDITION_RETURN_APPL_LAYER</a>(p == &amp;*m_value.end(), <span class="stringliteral">"incorrect number of characters written"</span>);
  }

<span class="keyword">private</span>:
  <span class="keyword">typedef</span> <a class="code" href="structpantheios_1_1util_1_1auto__buffer__selector.html" title="Type-generator template that deduces the appropriate specialisation of stlsoft::auto_buffer...">pantheios::util::auto_buffer_selector&lt;char, 256&gt;::type</a>   buffer_type;

  Person <span class="keyword">const</span>      &amp;m_person;
  buffer_type       m_value;
};

<span class="keyword">namespace </span>stlsoft
{

  <span class="keyword">inline</span> <span class="keywordtype">char</span> <span class="keyword">const</span> *c_str_data_a(Person_inserter <span class="keyword">const</span>&amp; pi)
  {
    <span class="keywordflow">return</span> pi.data();
  }

  <span class="keyword">inline</span> <span class="keywordtype">size_t</span> c_str_len_a(Person_inserter <span class="keyword">const</span>&amp; pi)
  {
    <span class="keywordflow">return</span> pi.size();
  }

} <span class="comment">// namespace stlsoft</span>

<span class="keyword">static</span> <span class="keywordtype">void</span> log_with_inserter_class(Person <span class="keyword">const</span>&amp; person)
{
  <a class="code" href="group__group____application__layer__interface____generated.html#g8bd2ef52fe9b01bc7f60483072e65d96" title="Logs 1 object of arbitrary type, subject to severity-level filtering, at severity...">pantheios::log_NOTICE</a>(<span class="stringliteral">"Person: "</span>, Person_inserter(person));
}

<span class="comment">/* ////////////////////////////////////////////////////////////////////// */</span>
</pre></div> <table width = "100%">
 <tr>
  <td width = "100%" colspan = "2">
   <hr width = "100%">
  </td>
 </tr>
 <tr>
  <td align = "center" valign = "middle">
   <font size = "-1">
    <a href = "http://pantheios.org/"><b>pantheios</b></a>
    Library documentation 
    © Matthew Wilson &amp;
    <a href="http://www.synesis.com.au">Synesis Software</a>,
    2006-2009
   </font>
  </td>
  <td align = "center" valign = "middle">
   <a href="http://sourceforge.net">
    <img src="http://sourceforge.net/sflogo.php?group_id=141831&amp;type=2" width="125" height="37" border="0" alt="SourceForge.net Logo" />
   </a>
  </td>
 </tr>
</table>
